# Twitter Clone | Firebase, NextAuth.js & Handless UI

![banner](banner.png)

> Twitter feed clone, where the user can authenticate and create a session through the Google provider implemented with NextAuth. Accessing the home feed, it is possible to send texts, emojis and image files through a post. The user will be able to view, like and comment on posts made by other users, in which the data is stored in Firebase through the Firestore Database and Storage services.

:arrow_right: NextAuth.js | Authentication & Session <br />
:arrow_right: Firebase | Backend as Service <br />
:arrow_right: Headless UI - Completely unstyled, fully accessible UI components, designed to integrate beautifully with Tailwind CSS. <br />
<br />

## NextAuth.js | Authentication & Session

With NextAuth it is possible to implement a user session (interval/period of time in which there is a communication between two or more devices) in a matter of minutes. 

### Add API route

To add NextAuth.js to a project create a file called  `[...nextauth].js` in `pages/api/auth`. This contains the dynamic route handler for NextAuth.js which will also contain all of your global NextAuth.js configurations.

```js
// pages/api/auth/[...nextauth].js

import NextAuth from 'next-auth'
import GoogleProvider from 'next-auth/providers/google'

export default NextAuth({
  // Configure one or more authentication providers
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    }),
  ],
  secret: process.env.JWT_SECRET,
  callbacks: {
    async session({ session, token }) {
      session.user.tag = session.user.name.split(' ').join('').toLowerCase()

      session.user.uid = token.sub
      return session
    },
  },
})
```

### Configure Shared session state

To be able to use `useSession` first you'll need to expose the session context, `<SessionProvider />`, at the top level of your application:

```jsx
// pages/_app.jsx

import { SessionProvider } from 'next-auth/react'
import '../styles/global.css'
import { RecoilRoot } from 'recoil'

const App = ({ Component, pageProps: { session, ...pageProps } }) => {
  return (
    <SessionProvider session={session}>
      <RecoilRoot>
        <Component {...pageProps} />
      </RecoilRoot>
    </SessionProvider>
  )
}

export default App
```

### Frontend - Add React Hook

The `useSession()` React Hook in the NextAuth.js client is the easiest way to check if someone is signed in.

```jsx
// pages/index.jsx

export default function Home({ trendingResults, followResults, providers }) {
  const { data: session } = useSession()
  const [isOpen, setIsOpen] = useRecoilState(modalState)

  if (!session) return <Login providers={providers} />

  return (
    <>
      <Head>
        <title>In√≠cio / Twitter</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="bg-[#15202b] min-h-screen flex max-w-[1260px] mx-auto">
        <Sidebar />
        <Feed />
        <Widgets
          trendingResults={trendingResults}
          followResults={followResults}
        />

        {isOpen && <Modal />}
      </main>
    </>
  )
}
```

### Deploying to production (NEXTAUTH_URL & JWT_SECRET) 

When deploying your site set the `NEXTAUTH_URL` environment variable to the canonical URL of the website. Not providing any secret or `JWT_SECRET` will throw an error in production, generate your secret in *<i>generate-secret.vercel.app/32</i>.

*<i>next-auth.js.org/getting-started/example</i>

<br />

## Firebase | Backend as Service 

Build advanced apps. Activate your backend without managing servers. Easily scale to serve millions of users with Firebase databases, machine learning infrastructure, storage and hosting solutions.

### Add Firebase to JavaScript Project - Create a Firebase project and register the app.

Before adding Firebase to your JavaScript app, create a Firebase project and register your app in that project. When you register your app with Firebase, you will receive a Firebase configuration object that will be used to connect your app to your Firebase project resources.

### Install the SDK and launch Firebase

The configuration instructions are from version 9 of the Firebase SDK for JavaScript, which uses a JavaScript module format.

```
npm install firebase
```

### Launch Firebase in the app and create a Firebase app object:

```js
// firebase.js

// Import the functions you need from the SDKs you need
import { initializeApp, getApp, getApps } from 'firebase/app'
import { getFirestore } from 'firebase/firestore'
import { getStorage } from 'firebase/storage'

const firebaseConfig = {
  apiKey: 'AIzaSyBkjm4VKY4Fk90qxMdDf8Guz3P7rqwDH8k',
  authDomain: 'twitter-clone-ed0c9.firebaseapp.com',
  projectId: 'twitter-clone-ed0c9',
  storageBucket: 'twitter-clone-ed0c9.appspot.com',
  messagingSenderId: '539515234424',
  appId: '1:539515234424:web:1c7974773216140c3ce58d',
}

// Initialize Firebase
const app = !getApps().length ? initializeApp(firebaseConfig) : getApp()
const db = getFirestore()
const storage = getStorage()

export default app
export { db, storage }
```

A `Firebase app` is a container-like object that stores common settings and shares authentication across Firebase services. After initializing a Firebase app object in code, you can add and start using Firebase services.

### Access Firebase in the app

Firebase services (such as Cloud Firestore, Authentication, Realtime Database, Remote Config, and more) are available for import in individual subpackages.

You can `get realtime updates` with Cloud Firestore. It is possible to listen to a document with the `onSnapshot()` method. An initial call using the callback you provide creates a document snapshot immediately with the current contents of the single document. Then, each time the contents change, another call updates the document snapshot:

```jsx
// components/Feed.jsx 

import { useEffect, useState } from 'react'
import { onSnapshot, collection, query, orderBy } from '@firebase/firestore'
import { db } from '../firebase'

const Feed = () => {
  const [posts, setPosts] = useState([])

 useEffect(
    () =>
      onSnapshot(
        query(collection(db, 'posts'), orderBy('timestamp', 'desc')),
        (snapshot) => {
          setPosts(snapshot.docs)
        }
      ),
    []
  )
 
// ...
```
*<i>firebase.google.com/docs/web/setup?authuser=0&hl=en</i>

<br />

## HeadlessUI - Completely unstyled, fully accessible UI components, designed to integrate beautifully with Tailwind CSS. 

The different components provided by HeadlessUI favor a dynamic, manageable and accessible interface in a matter of minutes.

### Dialog (Modal)

Modal is a window that opens over the page content without getting rid of it. To add the HeadlessUI modal, first install it via npm:

```
npm install @headlessui/react
```

### Showing and hiding your dialog

Dialogs are basically built using the `Dialog` and `Dialog.Panel` components. When its `open` prop is `true` the dialog should be rendered, and when it is `false` the dialog is undone.

The onClose callback fires when an open dialog is dismissed, which happens when the user clicks outside the your Dialog.Panel or presses the Escape key. You can use this callback to set open back to false and close your dialog.


```jsx
// ex: headlessui.com/react/dialog

import { useState } from 'react'
import { Dialog } from '@headlessui/react'

function MyDialog() {
  // The open/closed state lives outside of the Dialog and is managed by you
  let [isOpen, setIsOpen] = useState(true)

  function handleDeactivate() {
    // ...
  }

  return (
    /*
      Pass `isOpen` to the `open` prop, and use `onClose` to set
      the state back to `false` when the user clicks outside of
      the dialog or presses the escape key.
    */
    <Dialog open={isOpen} onClose={() => setIsOpen(false)}>
      <Dialog.Panel>
        <Dialog.Title>Deactivate account</Dialog.Title>
        <Dialog.Description>
          This will permanently deactivate your account
        </Dialog.Description>

        <p>
          Are you sure you want to deactivate your account? All of your data
          will be permanently removed. This action cannot be undone.
        </p>

        {/*
          You can render additional buttons to dismiss your dialog by setting
          `isOpen` to `false`.
        */}
        <button onClick={() => setIsOpen(false)}>Cancel</button>
        <button onClick={handleDeactivate}>Deactivate</button>
      </Dialog.Panel>
    </Dialog>
  )
}

```

### Styling the dialog

Style the `Dialog` and `Dialog.Panel` components using the className or style props like you would with any other element. `Dialog.Panel` determines the limit of your modal box, while `Dialog` determines the modal page. If you want to add an overlay layer, use the `Dialog.Overlay` component.

### Transitions

To animate the opening/closing of the dialog, use the `Transition component`. All you need to do is wrap the Dialog in a <Transition>, and dialog will transition automatically based on the state of the show prop on the <Transition>.

When using <Transition> with your dialogs, you can remove the `open` prop, as the dialog will read the `show` state from the <Transition> automatically. To animate your backdrop and panel separately, wrap your Dialog in Transition and wrap your backdrop and panel each with their own `Transition.Child`:

```jsx
// components/Modal.jsx 

import { modalState } from '../atoms/modalAtom'
import { Dialog, Transition } from '@headlessui/react'
import { Fragment, useEffect, useState } from 'react'
// ... 

function Modal() {
  const [isOpen, setIsOpen] = useRecoilState(modalState)
  
  return (
    <Transition.Root show={isOpen} as={Fragment}>
      <Dialog as="div" className="fixed inset-0 z-50 pt-8" onClose={setIsOpen}>
        <div className="flex items-start justify-center min-h-[800px] sm:min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
          <Transition.Child
            as={Fragment}
            enter="ease-out duration-300"
            enterFrom="opacity-0"
            enterTo="opacity-100"
            leave="ease-in duration-200"
            leaveFrom="opacity-100"
            leaveTo="opacity-0"
          >
            <Dialog.Overlay className="fixed inset-0 bg-[#5b7083] bg-opacity-40 transition-opacity" />
          </Transition.Child>

          <Transition.Child
            as={Fragment}
            enter="ease-out duration-300"
            enterFrom="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
            enterTo="opacity-100 translate-y-0 sm:scale-100"
            leave="ease-in duration-200"
            leaveFrom="opacity-100 translate-y-0 sm:scale-100"
            leaveTo="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          >
            <Dialog.Panel className="inline-block overflow-hidden text-left align-bottom transition-all transform bg-[#15202b] shadow-xl rounded-2xl sm:my-8 sm:align-middle sm:max-w-xl sm:w-full">
            
             {/* Modal Content */}
             
            </Dialog.Panel>
          </Transition.Child>
        </div>
      </Dialog>
    </Transition.Root>
  )
}

export default Modal
```

*<i>headlessui.com/react/dialog</i>

